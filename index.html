<html>
<head>
    <link href="https://episphere.github.io/gps/obs.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="index.js"></script>
</head>
<body>
    <h1>TCGA Path</h1>
    <h2>Embedding Text Example</h2>
    <div>
        <h3>Original Text:</h3>
        <p id="originalText"></p>
    </div>

    <div>
        <h3>Embedding:</h3>
        <pre id="embedding"></pre>
    </div>

    <h2>Upload Excel File to be embedded</h2>

    <!-- File Upload for Excel -->
    <div>
        <h3>Upload Excel File:</h3>
        <input type="file" id="upload" accept=".xlsx, .xls" />
    </div>

    <script>
        // Function to get embedding (assuming it is defined in index.js)
        async function getEmbedding(text) {
            const response = await (new (await import('https://episphere.github.io/gemini/gem.mjs')).GEM()).embed('TCGA-BP-5195.25c0b433-5557-4165-922e-2c1eac9c26f0, Date of Receipt: Clinical Diagnosis & History: Incidental 3 cm left upper pole renal mass. Specimens Submitted: 1: Kidney, Left Upper Pole')

            if (!response.ok) {
                throw new Error('Error retrieving embedding');
            }

            const data = await response.json();
            return data.embedding;
        }

        // Event listener for file upload
        document.getElementById('upload').addEventListener('change', handleFile, false);

        function handleFile(event) {
            const file = event.target.files[0];
            const reader = new FileReader();

            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                const json = XLSX.utils.sheet_to_json(worksheet);

                const firstRowText = json[0]?.text; // Adjust column key
                document.getElementById('originalText').textContent = firstRowText;

                if (firstRowText) {
                    getEmbedding(firstRowText)
                        .then(embedding => {
                            document.getElementById('embedding').textContent = JSON.stringify(embedding, null, 2);
                        })
                        .catch(error => {
                            console.error('Error retrieving embedding:', error);
                        });
                }
            };

            reader.readAsArrayBuffer(file);
        }
    </script>
</body>
</html>
