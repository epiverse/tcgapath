<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://episphere.github.io/gps/obs.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <title>TCGA Path</title>
</head>
<body>
    <h1>TCGA Path</h1>
    <h2>Batch Embedding Example</h2>

    <div>
        <h3>Original Texts:</h3>
        <ul id="originalTexts">
            <li>TCGA-BP-5195.25c0b433-5557-4165-922e-2c1eac9c26f0, Date of Receipt: Clinical Diagnosis & History: Incidental 3 cm left upper pole renal mass. Specimens Submitted: 1: Kidney, Left Upper Pole</li>
            <li>What is the meaning of life?</li>
            <li>How much wood would a woodchuck chuck?</li>
            <li>How does the brain work?</li>
        </ul>
    </div>

    <div>
        <h3>Embedding for Specific Text:</h3>
        <pre id="singleEmbedding">Fetching embedding for specific text...</pre>
    </div>

    <div>
        <h3>Batch Embeddings:</h3>
        <pre id="batchEmbeddings">Fetching batch embeddings...</pre>
    </div>

    <script>
        // Function to get embedding using Gemini API
        async function getEmbedding(text) {
            try {
                const gemini = new (await import('https://episphere.github.io/gemini/gem.mjs')).GEM();
                const embedding = await gemini.embed(text);
                return embedding;
            } catch (error) {
                console.error('Error retrieving embedding:', error);
                return null;  // Return null in case of an error
            }
        }

        // Function to display the single embedding result on the webpage
        function displaySingleEmbedding(embedding) {
            if (embedding) {
                document.getElementById('singleEmbedding').textContent = JSON.stringify(embedding, null, 2);
            } else {
                document.getElementById('singleEmbedding').textContent = 'Error generating embedding.';
            }
        }

        // Function to get batch embeddings using Gemini API
        async function getBatchEmbeddings(texts) {
            try {
                const gemini = new (await import('https://episphere.github.io/gemini/gem.mjs')).GEM();
                const formattedTexts = texts.map(text => ({ "text": text.text }));
                const embeddings = await gemini.embed(formattedTexts);
                console.log("Batch embeddings retrieved successfully:", embeddings);
                return embeddings;
            } catch (error) {
                console.error('Error retrieving batch embeddings:', error);
                return null; // Return null in case of an error
            }
        }

        // Function to display the batch embedding results on the webpage
        function displayBatchEmbeddings(embeddings) {
            if (embeddings) {
                document.getElementById('batchEmbeddings').textContent = JSON.stringify(embeddings, null, 2);
            } else {
                document.getElementById('batchEmbeddings').textContent = 'Error generating batch embeddings. Check console for details.';
            }
        }

        // On page load, first get the embedding for a specific text
        document.addEventListener('DOMContentLoaded', async () => {
            const specificText = 'TCGA-BP-5195.25c0b433-5557-4165-922e-2c1eac9c26f0, Date of Receipt: Clinical Diagnosis & History: Incidental 3 cm left upper pole renal mass. Specimens Submitted: 1: Kidney, Left Upper Pole';

            // Display a loading message while fetching the single embedding
            document.getElementById('singleEmbedding').textContent = 'Fetching embedding for specific text...';

            // Get the embedding for the specific text
            const singleEmbedding = await getEmbedding(specificText);
            displaySingleEmbedding(singleEmbedding);

            // After displaying the single embedding, fetch batch embeddings
            const texts = [
                { "text": 'TCGA-BP-5195.25c0b433-5557-4165-922e-2c1eac9c26f0, Date of Receipt: Clinical Diagnosis & History: Incidental 3 cm left upper pole renal mass. Specimens Submitted: 1: Kidney, Left Upper Pole' },
                { "text": 'What is the meaning of life?' },
                { "text": 'How much wood would a woodchuck chuck?' },
                { "text": 'How does the brain work?' }
            ];

            // Display a loading message while fetching batch embeddings
            document.getElementById('batchEmbeddings').textContent = 'Fetching batch embeddings...';

            // Get batch embeddings for the texts
            const batchEmbeddings = await getBatchEmbeddings(texts);
            displayBatchEmbeddings(batchEmbeddings);
        });
    </script>
</body>
</html>
